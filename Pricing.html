<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EV4Y6N8M5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-6EV4Y6N8M5');
</script>
<link rel="icon" type="image/png" href="/favicon.png">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing - Lexcello LNAT Practice Tests</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #1a365d;
            --primary-hover: #2d4a66;
            --secondary-color: #2b6cb0;
            --accent-gold: #d69e2e;
            --text-dark: #1a202c;
            --text-light: #4a5568;
            --bg-light: #f7fafc;
            --success-color: #48bb78;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            padding-top: 80px;
        }
        
        /* Navigation */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color) !important;
            letter-spacing: -1px;
        }
        
        .nav-link {
            font-weight: 500;
            color: var(--text-dark) !important;
            margin: 0 0.5rem;
        }
        
        .nav-link:hover {
            color: var(--secondary-color) !important;
        }

        .navbar-collapse.show {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .btn-primary {
            background: var(--secondary-color);
            border: none;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        .btn-outline-primary {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
            color: white;
        }

        /* User menu styles */
        .user-menu {
            position: relative;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-avatar:hover {
            background: var(--primary-hover);
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            padding: 10px 0;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .user-dropdown a {
            display: block;
            padding: 10px 20px;
            color: var(--text-dark);
            text-decoration: none;
            transition: background 0.3s ease;
        }
        
        .user-dropdown a:hover {
            background: var(--bg-light);
        }
        
        .user-dropdown .divider {
            height: 1px;
            background: #e2e8f0;
            margin: 5px 0;
        }
        
        /* Header Section */
        .pricing-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 50px 0 40px;
            text-align: center;
        }

        .pricing-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
        }

        .pricing-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 900px;
            margin: 0 auto;
            line-height: 1.4;
        }
        
        /* Pricing Cards */
        .pricing-section {
            padding: 80px 0;
            background: var(--bg-light);
        }
        
        .pricing-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 3px solid transparent;
            position: relative;
            height: 100%;
            transition: all 0.3s ease;
        }
        
        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }
        
        .pricing-card.featured {
            border-color: var(--accent-gold);
            transform: scale(1.05);
        }
        
        .featured-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-gold);
            color: var(--primary-color);
            padding: 8px 24px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        
        .price-tag {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .currency-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .currency-btn {
            background: transparent;
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .currency-btn.active {
            background: var(--secondary-color);
            color: white;
        }
        
        .price-amount {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--primary-color);
            line-height: 1;
        }
        
        .price-currency {
            font-size: 1.5rem;
            vertical-align: top;
        }
        
        .price-period {
            font-size: 1rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .currency-disclaimer {
            margin-top: 15px;
            padding: 12px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            text-align: left;
        }

        .currency-disclaimer small {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .currency-disclaimer i {
            color: #856404;
            margin-right: 5px;
        }
        
        .plan-title {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .plan-description {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .features-list {
            list-style: none;
            padding: 0;
            margin-bottom: 40px;
        }
        
        .features-list li {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .features-list i {
            color: #48bb78;
            margin-right: 12px;
            font-size: 1.2rem;
        }
        
        .cta-button {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 12px;
            border: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary-custom {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary-custom:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        /* Already subscribed state */
        .btn-subscribed {
            background: var(--success-color);
            color: white;
            cursor: default;
        }
        
        .btn-subscribed:hover {
            background: var(--success-color);
            transform: none;
        }
        
        /* FAQ Section */
        .faq-section {
            padding: 80px 0;
            background: white;
        }
        
        .faq-item {
            background: var(--bg-light);
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .faq-question {
            width: 100%;
            background: none;
            border: none;
            padding: 25px 30px;
            text-align: left;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .faq-answer {
            padding: 0 30px 25px;
            color: var(--text-light);
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        /* Guarantee Section */
        .guarantee-section {
            background: var(--primary-color);
            color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .guarantee-icon {
            font-size: 4rem;
            color: var(--accent-gold);
            margin-bottom: 20px;
        }
        
        .guarantee-section h3 {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        
        .guarantee-section p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* Footer */
        .footer {
            background: #1a202c;
            color: white;
            padding: 40px 0 20px;
        }
        
        .footer-links a {
            color: #a0aec0;
            text-decoration: none;
            margin-right: 20px;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        @media (max-width: 768px) {
            .pricing-header h1 {
                font-size: 2.2rem;
            }
            
            .pricing-card.featured {
                transform: none;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">Lexcello</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#tests">Practice Tests</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about-lnat.html">About LNAT</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="resources.html">Resources</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="pricing.html">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">Contact</a>
                    </li>
                </ul>
                
                <!-- Authentication buttons (shown when not logged in) -->
                <div class="d-flex gap-2" id="auth-buttons">
                    <button class="btn btn-outline-primary" onclick="signIn()">Sign In</button>
                    <button class="btn btn-primary" onclick="getStarted()">Get Started</button>
                </div>
                
                <!-- User menu (shown when logged in) -->
                <div class="user-menu" id="user-menu" style="display: none;">
                    <div class="user-avatar" onclick="toggleUserDropdown()" id="user-avatar">
                        U
                    </div>
                    <div class="user-dropdown" id="user-dropdown">
                        <a href="dashboard.html">
                            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
                        <a href="profile.html">
                            <i class="fas fa-user me-2"></i>Profile
                        </a>
                        <a href="test-history.html">
                            <i class="fas fa-history me-2"></i>Test History
                        </a>
                        <div class="divider"></div>
                        <a href="#" onclick="signOut()">
                            <i class="fas fa-sign-out-alt me-2"></i>Sign Out
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="pricing-header">
        <div class="container">
            <h1>Simple, Transparent Pricing</h1>
            <p>Get unlimited access to all 10 LNAT practice tests and premium features with one comprehensive package</p>
        </div>
    </section>

    <!-- Pricing Section -->
    <section class="pricing-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-xl-7">
                    <div class="pricing-card featured">
                        <div class="featured-badge">Most Popular</div>
                        
                        <div class="currency-switch">
                            <button class="currency-btn active" onclick="switchCurrency('GBP')">£ GBP</button>
                            <button class="currency-btn" onclick="switchCurrency('USD')">$ USD</button>
                            <button class="currency-btn" onclick="switchCurrency('INR')">₹ INR</button>
                        </div>

                        <div class="price-tag">
                            <div class="price-amount">
                                <span class="price-currency" id="currency-symbol">£</span><span id="price-amount">79</span>
                            </div>
                            <div class="price-period">12 months access • One-time payment</div>
                            
                            <!-- Coupon Input Section -->
                            <div class="coupon-section" style="margin-top: 25px;">
                                <div style="display: flex; gap: 10px; max-width: 400px; margin: 0 auto;">
                                    <input type="text" 
                                           id="coupon-input" 
                                           class="form-control" 
                                           placeholder="Have a coupon code?" 
                                           style="text-transform: uppercase; flex: 1;">
                                    <button class="btn btn-outline-primary" 
                                            onclick="applyCoupon()" 
                                            id="apply-coupon-btn"
                                            style="white-space: nowrap;">
                                        Apply
                                    </button>
                                </div>
                                
                                <!-- Coupon Status Messages -->
                                <div id="coupon-message" style="margin-top: 10px; display: none;"></div>
                                
                                <!-- Discount Display -->
                                <div id="discount-display" style="display: none; margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong style="color: #155724;">✓ Coupon Applied: <span id="applied-coupon-code"></span></strong>
                                            <div style="font-size: 0.9rem; color: #155724; margin-top: 5px;">
                                                <span id="discount-description"></span>
                                            </div>
                                        </div>
                                        <button onclick="removeCoupon()" 
                                                style="background: none; border: none; color: #721c24; font-size: 1.2rem; cursor: pointer; padding: 5px 10px;"
                                                title="Remove coupon">
                                            ×
                                        </button>
                                    </div>
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #c3e6cb;">
                                        <div style="display: flex; justify-content: space-between; font-size: 0.95rem; color: #666; margin-bottom: 5px;">
                                            <span>Original Price:</span>
                                            <span style="text-decoration: line-through;" id="original-price-display">£79</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-size: 1.1rem; font-weight: bold; color: #155724;">
                                            <span>Final Price:</span>
                                            <span id="final-price-display">£59</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #28a745; margin-top: 5px;">
                                            <span>You Save:</span>
                                            <span id="savings-display">£20</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="currency-disclaimer" id="currency-disclaimer" style="display: block;">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    You will be charged <strong>₹9,000 INR</strong> (approximately <span id="selected-currency-name">£79</span>). 
                                    Final amount in your currency may vary based on current exchange rates.
                                </small>
                            </div>
                        </div>
                        
                        <div class="plan-title">Complete LNAT Preparation</div>
                        <div class="plan-description">Everything you need to excel at the LNAT</div>
                        
                        <ul class="features-list">
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>All 10 Practice Tests</strong> (8 available now, 2 more coming)</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>400+ Authentic Questions</strong> mirroring real LNAT format</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Detailed Performance Analytics</strong> tracking your progress</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Timed Practice Sessions</strong> with real exam conditions</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Comprehensive Answer Explanations</strong> for every question</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Score Prediction Algorithm</strong> based on performance data</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Unlimited Retakes</strong> for all practice tests</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Mobile & Desktop Access</strong> study anywhere, anytime</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>12 Months Access</strong> from purchase date</span>
                            </li>
                            <li>
                                <i class="fas fa-check-circle"></i>
                                <span><strong>Free Updates</strong> when new tests are released</span>
                            </li>
                        </ul>
                        
                        <button class="cta-button btn-primary-custom" id="ctaButton" onclick="handleSubscription()">
                            <i class="fas fa-rocket me-2"></i>Start Your LNAT Preparation
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>International Pricing Available:</strong> Choose your preferred currency. Get full access to all 10 tests. 
                            As we add more tests and features, this price may increase.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Guarantee Section -->
    <section class="guarantee-section">
        <div class="container">
            <div class="guarantee-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h3>3-Day Money-Back Guarantee</h3>
            <p>We're confident you'll love our LNAT preparation platform. If you're not completely satisfied within 3 days, we'll refund your money, no questions asked.</p>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="faq-section">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-4 fw-bold text-primary">Frequently Asked Questions</h2>
            </div>
            
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            How long do I have access to the platform?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            You get 12 months of full access from your purchase date. This gives you plenty of time to prepare thoroughly for the LNAT, whether you're taking it soon or planning ahead for next year's application cycle.
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            What happens when the remaining 2 tests are released?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            You'll automatically get access to all new tests as they're released - no additional payment required. We're releasing approximately 1-2 new tests per month until all 10 are available.
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            Are these questions similar to the real LNAT?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            Yes, our questions are crafted by legal education experts to mirror the real LNAT in format, difficulty, and style. We've analyzed thousands of past LNAT questions to ensure authenticity in our practice materials.
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            Can I retake the practice tests?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            Absolutely! You can retake any practice test as many times as you want during your 12-month access period. This helps you track improvement and work on specific areas where you need more practice.
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            Is there a free trial available?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            We offer a sample test with 42 questions that you can try for free on our homepage. This gives you a taste of our question quality and platform interface. With our 3-day money-back guarantee, your purchase is risk-free.
                        </div>
                    </div>
                    
                    <div class="faq-item">
                        <button class="faq-question" onclick="toggleFaq(this)">
                            How does the performance analytics work?
                            <i class="fas fa-plus"></i>
                        </button>
                        <div class="faq-answer" style="display: none;">
                            Our analytics track your performance across all practice tests, showing trends in accuracy, timing, and question types. You'll see detailed breakdowns of your strengths and weaknesses, helping you focus your study time effectively.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="text-center">
                <div class="footer-links mb-3">
                    <a href="index.html">Home</a>
                    <a href="about-lnat.html">About LNAT</a>
                    <a href="pricing.html">Pricing</a>
                    <a href="contact.html">Contact</a>
                    <a href="#privacy">Privacy Policy</a>
                    <a href="#terms">Terms of Service</a>
                </div>
                <p class="text-muted">&copy; 2024 Lexcello. All rights reserved. LNAT® is a trademark of the LNAT Consortium.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Configuration
        const API_BASE_URL = 'https://lexcello-backend.onrender.com/api';
        
        // State management
        let currentUser = null;
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            checkForScholarshipCode();
            
            // Add click listener to close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('user-menu');
                const dropdown = document.getElementById('user-dropdown');
                
                if (userMenu && !userMenu.contains(event.target)) {
                    dropdown.classList.remove('show');
                }
            });
        });
        
        // Authentication functions
        async function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            if (token) {
                try {
                    const response = await fetch(`${API_BASE_URL}/auth/profile`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const userData = await response.json();
                        updateUIForLoggedInUser(userData);
                    } else {
                        localStorage.removeItem('authToken');
                        updateUIForLoggedOutUser();
                    }
                } catch (error) {
                    console.error('Error checking auth status:', error);
                    updateUIForLoggedOutUser();
                }
            } else {
                updateUIForLoggedOutUser();
            }
        }
        
        function updateUIForLoggedInUser(userData) {
            currentUser = userData;
            
            document.getElementById('auth-buttons').style.display = 'none';
            document.getElementById('user-menu').style.display = 'block';
            
            const userAvatar = document.getElementById('user-avatar');
            const firstLetter = (userData.name || userData.email || 'U').charAt(0).toUpperCase();
            userAvatar.textContent = firstLetter;
            userAvatar.title = userData.email || 'User';
            
            updateCTAButton();
        }
        
        function updateUIForLoggedOutUser() {
            currentUser = null;
            
            document.getElementById('auth-buttons').style.display = 'flex';
            document.getElementById('user-menu').style.display = 'none';
            
            updateCTAButton();
        }
        
        function updateCTAButton() {
            const ctaButton = document.getElementById('ctaButton');
            
            if (currentUser) {
                if (currentUser.subscriptionStatus === 'premium') {
                    ctaButton.innerHTML = '<i class="fas fa-check me-2"></i>Access Your Dashboard';
                    ctaButton.className = 'cta-button btn-subscribed';
                    ctaButton.onclick = () => window.location.href = 'dashboard.html';
                } else {
                    ctaButton.innerHTML = '<i class="fas fa-credit-card me-2"></i>Complete Your Purchase';
                    ctaButton.className = 'cta-button btn-primary-custom';
                    ctaButton.onclick = handleSubscription;
                }
            } else {
                ctaButton.innerHTML = '<i class="fas fa-rocket me-2"></i>Start Your LNAT Preparation';
                ctaButton.className = 'cta-button btn-primary-custom';
                ctaButton.onclick = handleSubscription;
            }
        }
        
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('show');
        }
        
        async function signOut() {
            try {
                const token = localStorage.getItem('authToken');
                if (token) {
                    await fetch(`${API_BASE_URL}/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                }
            } catch (error) {
                console.error('Error during logout:', error);
            } finally {
                localStorage.removeItem('authToken');
                updateUIForLoggedOutUser();
                
                if (window.location.pathname.includes('dashboard') || 
                    window.location.pathname.includes('profile')) {
                    window.location.href = 'index.html';
                }
            }
        }
        
        // Navigation functions
        function signIn() {
            window.location.href = 'login.html';
        }
        
        function getStarted() {
            if (currentUser) {
                if (currentUser.subscriptionStatus === 'premium') {
                    window.location.href = 'dashboard.html';
                } else {
                    window.location.href = 'payment.html';
                }
            } else {
                window.location.href = 'register.html';
            }
        }
        
        // Pricing functions
        const prices = {
            INR: { 
                symbol: '₹', 
                amount: 9000, 
                display: '9,000', 
                code: 'INR', 
                monthly: '₹750',
                name: 'Indian Rupees',
                showDisclaimer: false
            },
            USD: { 
                symbol: '$', 
                amount: 9000,
                display: '99', 
                code: 'INR',
                monthly: '$8.25',
                name: 'US Dollars',
                showDisclaimer: true,
                actualCurrency: 'USD'
            },
            GBP: { 
                symbol: '£', 
                amount: 9000,
                display: '79', 
                code: 'INR',
                monthly: '£6.58',
                name: 'British Pounds',
                showDisclaimer: true,
                actualCurrency: 'GBP'
            }
        };
        
        let selectedCurrency = 'GBP';
        
        function switchCurrency(currency) {
            selectedCurrency = currency;
            
            const buttons = document.querySelectorAll('.currency-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const price = prices[currency];
            document.getElementById('currency-symbol').textContent = price.symbol;
            
            if (appliedCoupon) {
                const displayOriginal = parseFloat(price.display.replace(/,/g, ''));
                const displayDiscount = (discountAmount * displayOriginal / price.amount).toFixed(2);
                const displayFinal = (displayOriginal - displayDiscount).toFixed(2);
                
                const formattedOriginal = selectedCurrency === 'INR' 
                    ? displayOriginal.toLocaleString('en-IN')
                    : displayOriginal;
                const formattedFinal = selectedCurrency === 'INR' 
                    ? parseFloat(displayFinal).toLocaleString('en-IN')
                    : displayFinal;
                const formattedDiscount = selectedCurrency === 'INR'
                    ? parseFloat(displayDiscount).toLocaleString('en-IN')
                    : displayDiscount;
                
                document.getElementById('price-amount').innerHTML = 
                    `<span style="text-decoration: line-through; opacity: 0.5; font-size: 0.6em;">${formattedOriginal}</span> ${formattedFinal}`;
                
                document.getElementById('original-price-display').textContent = 
                    `${price.symbol}${formattedOriginal}`;
                document.getElementById('final-price-display').textContent = 
                    `${price.symbol}${formattedFinal}`;
                document.getElementById('savings-display').textContent = 
                    `${price.symbol}${formattedDiscount}`;
                
                if (price.showDisclaimer) {
                    const disclaimer = document.getElementById('currency-disclaimer');
                    const discountedINR = (9000 - discountAmount).toFixed(0);
                    const formattedDiscountedINR = Number(discountedINR).toLocaleString('en-IN');
                    const formattedFinalForDisclaimer = selectedCurrency === 'INR' 
                        ? parseFloat(displayFinal).toLocaleString('en-IN')
                        : displayFinal;
                    
                    disclaimer.innerHTML = `
                        <small class="text-muted">
                            <i class="fas fa-info-circle"></i> 
                            You will be charged <strong>₹${formattedDiscountedINR} INR</strong> (approximately ${price.symbol}${formattedFinalForDisclaimer}). 
                            Final amount in your currency may vary based on current exchange rates.
                        </small>
                    `;
                }
            } else {
                document.getElementById('price-amount').textContent = price.display;
                
                const disclaimer = document.getElementById('currency-disclaimer');
                const currencyName = document.getElementById('selected-currency-name');
                
                if (price.showDisclaimer) {
                    disclaimer.style.display = 'block';
                    currencyName.textContent = `${price.symbol}${price.display}`;
                } else {
                    disclaimer.style.display = 'none';
                }
            }
        }
        
        function toggleFaq(button) {
            const answer = button.nextElementSibling;
            const icon = button.querySelector('i');
            
            if (answer.style.display === 'none' || answer.style.display === '') {
                answer.style.display = 'block';
                icon.classList.remove('fa-plus');
                icon.classList.add('fa-minus');
            } else {
                answer.style.display = 'none';
                icon.classList.remove('fa-minus');
                icon.classList.add('fa-plus');
            }
        }
        
        async function handleSubscription() {
            try {
                gtag('event', 'pricing_cta_click', {
                    'event_category': 'pricing',
                    'event_label': 'start_lnat_preparation',
                    'user_logged_in': currentUser ? 'yes' : 'no',
                    'subscription_status': currentUser ? currentUser.subscriptionStatus : 'not_logged_in',
                    'selected_currency': selectedCurrency
                });
            } catch (error) {
                console.error('Tracking error:', error);
            }
            
            if (!currentUser) {
                try {
                    gtag('event', 'redirect_to_register', {
                        'event_category': 'pricing',
                        'event_label': 'from_pricing_page'
                    });
                } catch (error) {
                    console.error('Tracking error:', error);
                }
                
                window.location.href = 'register.html';
                return;
            }
            
            if (currentUser.subscriptionStatus === 'premium') {
                try {
                    gtag('event', 'redirect_to_dashboard', {
                        'event_category': 'pricing',
                        'event_label': 'already_subscribed'
                    });
                } catch (error) {
                    console.error('Tracking error:', error);
                }
                
                window.location.href = 'dashboard.html';
                return;
            }
            
            localStorage.setItem('selectedCurrency', selectedCurrency);
            localStorage.setItem('selectedAmount', prices[selectedCurrency].amount);
            
            try {
                gtag('event', 'redirect_to_payment', {
                    'event_category': 'pricing',
                    'event_label': 'from_pricing_page',
                    'user_email': currentUser.email,
                    'currency': selectedCurrency,
                    'amount': prices[selectedCurrency].amount
                });
            } catch (error) {
                console.error('Tracking error:', error);
            }
            
            window.location.href = 'payment.html';
        }
        
        // Coupon Management
        let appliedCoupon = null;
        let discountAmount = 0;
        let finalPrice = 0;

        async function applyCoupon() {
            const couponInput = document.getElementById('coupon-input');
            const couponCode = couponInput.value.trim().toUpperCase();
            
            if (!couponCode) {
                showCouponMessage('Please enter a coupon code', 'error');
                return;
            }
            
            const applyBtn = document.getElementById('apply-coupon-btn');
            applyBtn.disabled = true;
            applyBtn.textContent = 'Checking...';
            
            try {
                const currentPrice = prices[selectedCurrency];
                const originalAmount = currentPrice.amount;
                
                const validateResponse = await fetch(`${API_BASE_URL}/coupons/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: couponCode })
                });
                
                if (!validateResponse.ok) {
                    const error = await validateResponse.json();
                    showCouponMessage(error.error || 'Invalid coupon code', 'error');
                    applyBtn.disabled = false;
                    applyBtn.textContent = 'Apply';
                    return;
                }
                
                const calculateResponse = await fetch(`${API_BASE_URL}/coupons/calculate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: couponCode,
                        originalAmount: originalAmount
                    })
                });
                
                if (!calculateResponse.ok) {
                    const error = await calculateResponse.json();
                    showCouponMessage(error.error || 'Failed to apply coupon', 'error');
                    applyBtn.disabled = false;
                    applyBtn.textContent = 'Apply';
                    return;
                }
                
                const discountData = await calculateResponse.json();
                
                if (discountData.success) {
                    appliedCoupon = discountData.coupon;
                    discountAmount = discountData.discountAmount;
                    finalPrice = discountData.finalAmount;
                    
                    displayDiscount(discountData, currentPrice);
                    showCouponMessage('Coupon applied successfully!', 'success');
                    
                    localStorage.setItem('appliedCoupon', JSON.stringify({
                        code: couponCode,
                        couponId: discountData.couponId,
                        discountAmount: discountAmount,
                        finalAmount: finalPrice
                    }));
                    
                    try {
                        gtag('event', 'coupon_applied', {
                            'event_category': 'pricing',
                            'event_label': couponCode,
                            'value': discountAmount
                        });
                    } catch (error) {
                        console.error('GA tracking error:', error);
                    }
                    
                    couponInput.disabled = true;
                }
                
            } catch (error) {
                console.error('Coupon error:', error);
                showCouponMessage('Failed to apply coupon. Please try again.', 'error');
            } finally {
                applyBtn.disabled = false;
                applyBtn.textContent = 'Apply';
            }
        }

        function displayDiscount(discountData, currentPrice) {
            document.getElementById('discount-display').style.display = 'block';
            
            document.getElementById('applied-coupon-code').textContent = discountData.coupon.code;
            
            const description = discountData.coupon.description || 
                `${discountData.discountAmount === discountData.originalAmount ? 'Free' : 
                  `Save ${currentPrice.symbol}${(discountData.discountAmount * parseFloat(currentPrice.display) / currentPrice.amount).toFixed(2)}`}`;
            document.getElementById('discount-description').textContent = description;
            
            const displayOriginal = parseFloat(currentPrice.display.replace(/,/g, ''));
            const displayDiscount = (discountData.discountAmount * displayOriginal / currentPrice.amount).toFixed(2);
            const displayFinal = (displayOriginal - displayDiscount).toFixed(2);
            
            const formattedOriginal = selectedCurrency === 'INR' 
                ? displayOriginal.toLocaleString('en-IN')
                : displayOriginal;
            const formattedFinal = selectedCurrency === 'INR' 
                ? parseFloat(displayFinal).toLocaleString('en-IN')
                : displayFinal;
            const formattedDiscount = selectedCurrency === 'INR'
                ? parseFloat(displayDiscount).toLocaleString('en-IN')
                : displayDiscount;
            
            document.getElementById('original-price-display').textContent = 
                `${currentPrice.symbol}${formattedOriginal}`;
            document.getElementById('final-price-display').textContent = 
                `${currentPrice.symbol}${formattedFinal}`;
            document.getElementById('savings-display').textContent = 
                `${currentPrice.symbol}${formattedDiscount}`;
            
            document.getElementById('price-amount').innerHTML = 
                `<span style="text-decoration: line-through; opacity: 0.5; font-size: 0.6em;">${formattedOriginal}</span> ${formattedFinal}`;
            
            if (currentPrice.showDisclaimer) {
                const disclaimer = document.getElementById('currency-disclaimer');
                const discountedINR = (9000 - discountData.discountAmount).toFixed(0);
                
                disclaimer.innerHTML = `
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i> 
                        You will be charged <strong>₹${Number(discountedINR).toLocaleString('en-IN')} INR</strong> (approximately ${currentPrice.symbol}${displayFinal}). 
                        Final amount in your currency may vary based on current exchange rates.
                    </small>
                `;
            }
        }

        function removeCoupon() {
            appliedCoupon = null;
            discountAmount = 0;
            finalPrice = 0;
            
            localStorage.removeItem('appliedCoupon');
            
            document.getElementById('discount-display').style.display = 'none';
            
            const couponInput = document.getElementById('coupon-input');
            couponInput.value = '';
            couponInput.disabled = false;
            
            const currentPrice = prices[selectedCurrency];
            document.getElementById('price-amount').textContent = currentPrice.display;
            
            if (currentPrice.showDisclaimer) {
                const disclaimer = document.getElementById('currency-disclaimer');
                disclaimer.innerHTML = `
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i> 
                        You will be charged <strong>₹9,000 INR</strong> (approximately ${currentPrice.symbol}${currentPrice.display}). 
                        Final amount in your currency may vary based on current exchange rates.
                    </small>
                `;
            }
            
            showCouponMessage('Coupon removed', 'info');
            
            try {
                gtag('event', 'coupon_removed', {
                    'event_category': 'pricing',
                    'event_label': 'user_action'
                });
            } catch (error) {
                console.error('GA tracking error:', error);
            }
        }

        function showCouponMessage(message, type) {
            const messageDiv = document.getElementById('coupon-message');
            
            const colors = {
                success: { bg: '#d4edda', text: '#155724', border: '#c3e6cb' },
                error: { bg: '#f8d7da', text: '#721c24', border: '#f5c6cb' },
                info: { bg: '#d1ecf1', text: '#0c5460', border: '#bee5eb' }
            };
            
            const color = colors[type] || colors.info;
            
            messageDiv.style.display = 'block';
            messageDiv.style.padding = '10px';
            messageDiv.style.borderRadius = '6px';
            messageDiv.style.background = color.bg;
            messageDiv.style.color = color.text;
            messageDiv.style.border = `1px solid ${color.border}`;
            messageDiv.style.fontSize = '0.9rem';
            messageDiv.textContent = message;
            
            setTimeout(() => {
                if (type !== 'success') {
                    messageDiv.style.display = 'none';
                }
            }, 5000);
        }

        // Scholarship Auto-Apply Functions
        function checkForScholarshipCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const scholarshipParam = urlParams.get('scholarship');
            
            if (scholarshipParam) {
                console.log('🎓 Scholarship code found in URL:', scholarshipParam);
                
                document.getElementById('coupon-input').value = scholarshipParam;
                
                setTimeout(() => {
                    applyCoupon();
                    showScholarshipWelcome();
                    window.history.replaceState({}, document.title, window.location.pathname);
                }, 500);
                
                return;
            }
            
            const scholarship = localStorage.getItem('activeScholarship');
            const couponCode = localStorage.getItem('scholarshipCoupon');
            
            if (scholarship || couponCode) {
                try {
                    const scholarshipData = scholarship ? JSON.parse(scholarship) : null;
                    const code = scholarshipData?.couponCode || couponCode;
                    
                    if (code) {
                        console.log('🎓 Scholarship found in localStorage:', code);
                        
                        if (scholarshipData?.validUntil) {
                            const validUntil = new Date(scholarshipData.validUntil);
                            const now = new Date();
                            
                            if (validUntil < now) {
                                console.log('❌ Scholarship expired');
                                localStorage.removeItem('activeScholarship');
                                localStorage.removeItem('scholarshipCoupon');
                                return;
                            }
                        }
                        
                        document.getElementById('coupon-input').value = code;
                        
                        setTimeout(() => {
                            applyCoupon();
                            showScholarshipWelcome();
                        }, 500);
                    }
                } catch (error) {
                    console.error('Error parsing scholarship:', error);
                }
            }
        }

        function showScholarshipWelcome() {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #ffd700, #ffed4e);
                border: 3px solid #d4af37;
                border-radius: 15px;
                padding: 20px 30px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                text-align: center;
                animation: slideDown 0.5s ease;
                max-width: 500px;
                width: 90%;
            `;
            
            welcomeDiv.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">🎉</div>
                <h4 style="color: #1a365d; margin-bottom: 10px; font-weight: 700;">Scholarship Applied!</h4>
                <p style="color: #4a5568; margin: 0; font-size: 0.95rem;">
                    Your exclusive discount has been automatically applied to your purchase.
                </p>
                <button onclick="this.parentElement.remove()" 
                        style="margin-top: 15px; padding: 8px 20px; background: #1a365d; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    Continue
                </button>
            `;
            
            document.body.appendChild(welcomeDiv);
            
            setTimeout(() => {
                if (welcomeDiv.parentElement) {
                    welcomeDiv.style.opacity = '0';
                    welcomeDiv.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => welcomeDiv.remove(), 500);
                }
            }, 8000);
            
            try {
                gtag('event', 'scholarship_auto_applied', {
                    'event_category': 'pricing',
                    'event_label': 'automatic_application'
                });
            } catch (error) {
                console.error('GA tracking error:', error);
            }
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translate(-50%, -100px);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
